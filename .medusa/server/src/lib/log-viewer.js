"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getLogDownloadHandle = exports.tailLogFile = exports.listLogFiles = exports.LogViewerError = void 0;
const fs_1 = require("fs");
const fs_2 = require("fs");
const path_1 = __importDefault(require("path"));
const DEFAULT_LOG_EXTENSIONS = [".log", ".txt", ".out", ".json"];
const LOG_NAME_PATTERN = /^[A-Za-z0-9._-]+$/;
const DEFAULT_LINE_LIMIT = Math.max(50, Math.min(500, Number(process.env.REDINGTON_LOG_LINE_LIMIT) || 400));
const DEFAULT_MAX_BYTES = Math.max(64 * 1024, Math.min(2 * 1024 * 1024, Number(process.env.REDINGTON_LOG_MAX_BYTES) || 512 * 1024));
const normalizeExt = (ext) => {
    if (!ext.length) {
        return "";
    }
    return ext.startsWith(".") ? ext.toLowerCase() : `.${ext.toLowerCase()}`;
};
const allowedExtensions = new Set();
DEFAULT_LOG_EXTENSIONS.forEach((ext) => allowedExtensions.add(ext));
const configuredExtensions = (process.env.REDINGTON_LOG_EXTENSIONS ?? "")
    .split(",")
    .map((value) => value.trim())
    .filter(Boolean);
configuredExtensions.forEach((ext) => allowedExtensions.add(normalizeExt(ext)));
const getLogRoot = () => {
    const configured = process.env.REDINGTON_LOG_ROOT;
    if (configured) {
        return path_1.default.resolve(configured);
    }
    return path_1.default.resolve(process.cwd(), "logs");
};
class LogViewerError extends Error {
    constructor(message, status = 400) {
        super(message);
        this.status = status;
    }
}
exports.LogViewerError = LogViewerError;
const ensureExtensionAllowed = (name) => {
    const ext = normalizeExt(path_1.default.extname(name));
    if (!ext || !allowedExtensions.has(ext)) {
        throw new LogViewerError("Unsupported log file extension.", 403);
    }
};
const sanitizeName = (name) => {
    const trimmed = String(name ?? "").trim();
    if (!trimmed.length) {
        throw new LogViewerError("Log file name is required.", 400);
    }
    if (!LOG_NAME_PATTERN.test(trimmed)) {
        throw new LogViewerError("Log file name contains invalid characters.", 400);
    }
    ensureExtensionAllowed(trimmed);
    return trimmed;
};
const resolveLogFile = async (name) => {
    const baseName = sanitizeName(name);
    const root = getLogRoot();
    await fs_2.promises.mkdir(root, { recursive: true });
    const filePath = path_1.default.join(root, baseName);
    const stats = await fs_2.promises.stat(filePath).catch((err) => {
        if (err.code === "ENOENT") {
            throw new LogViewerError("Log file not found.", 404);
        }
        throw err;
    });
    if (!stats.isFile()) {
        throw new LogViewerError("Log file not found.", 404);
    }
    return {
        filePath,
        stats,
        name: baseName,
        extension: normalizeExt(path_1.default.extname(baseName)),
        updated_at: stats.mtime.toISOString(),
    };
};
const listLogFiles = async () => {
    const root = getLogRoot();
    await fs_2.promises.mkdir(root, { recursive: true });
    const entries = await fs_2.promises.readdir(root, { withFileTypes: true });
    const summaries = [];
    for (const entry of entries) {
        if (!entry.isFile()) {
            continue;
        }
        const name = entry.name;
        try {
            ensureExtensionAllowed(name);
        }
        catch {
            continue;
        }
        const filePath = path_1.default.join(root, name);
        const stats = await fs_2.promises.stat(filePath).catch(() => null);
        if (!stats) {
            continue;
        }
        summaries.push({
            name,
            size: stats.size,
            updated_at: stats.mtime.toISOString(),
            extension: normalizeExt(path_1.default.extname(name)),
        });
    }
    summaries.sort((a, b) => {
        return new Date(b.updated_at).getTime() - new Date(a.updated_at).getTime();
    });
    return summaries;
};
exports.listLogFiles = listLogFiles;
const clampLines = (value) => {
    if (!value || !Number.isFinite(value)) {
        return DEFAULT_LINE_LIMIT;
    }
    return Math.min(2000, Math.max(50, Math.floor(value)));
};
const clampBytes = (value) => {
    if (!value || !Number.isFinite(value)) {
        return DEFAULT_MAX_BYTES;
    }
    return Math.min(5 * 1024 * 1024, Math.max(64 * 1024, Math.floor(value)));
};
const tailLogFile = async (name, options) => {
    const { filePath, stats, name: baseName, extension, updated_at } = await resolveLogFile(name);
    const lineLimit = clampLines(options?.lines);
    const maxBytes = clampBytes(options?.maxBytes);
    const startPosition = Math.max(0, stats.size - maxBytes);
    const length = stats.size - startPosition;
    const handle = await fs_2.promises.open(filePath, "r");
    try {
        const buffer = Buffer.alloc(length);
        await handle.read(buffer, 0, length, startPosition);
        const raw = buffer.toString("utf8");
        const split = raw.split(/\r?\n/);
        const trimmed = split[split.length - 1] === "" ? split.slice(0, -1) : split;
        const limited = trimmed.length > lineLimit
            ? trimmed.slice(trimmed.length - lineLimit)
            : trimmed;
        const truncated = trimmed.length > limited.length || startPosition > 0;
        return {
            name: baseName,
            lines: limited,
            truncated,
            size: stats.size,
            updated_at,
            extension,
        };
    }
    finally {
        await handle.close();
    }
};
exports.tailLogFile = tailLogFile;
const getLogDownloadHandle = async (name) => {
    const { filePath, stats, name: baseName, extension, updated_at } = await resolveLogFile(name);
    return {
        stream: (0, fs_1.createReadStream)(filePath),
        size: stats.size,
        name: baseName,
        extension,
        updated_at,
    };
};
exports.getLogDownloadHandle = getLogDownloadHandle;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9nLXZpZXdlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9saWIvbG9nLXZpZXdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSwyQkFBcUM7QUFDckMsMkJBQW1DO0FBQ25DLGdEQUF1QjtBQUV2QixNQUFNLHNCQUFzQixHQUFHLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUE7QUFDaEUsTUFBTSxnQkFBZ0IsR0FBRyxtQkFBbUIsQ0FBQTtBQUM1QyxNQUFNLGtCQUFrQixHQUFHLElBQUksQ0FBQyxHQUFHLENBQ2pDLEVBQUUsRUFDRixJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUNuRSxDQUFBO0FBQ0QsTUFBTSxpQkFBaUIsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUNoQyxFQUFFLEdBQUcsSUFBSSxFQUNULElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksR0FBRyxJQUFJLEVBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLENBQUMsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLENBQ3JGLENBQUE7QUFFRCxNQUFNLFlBQVksR0FBRyxDQUFDLEdBQVcsRUFBRSxFQUFFO0lBQ25DLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDaEIsT0FBTyxFQUFFLENBQUE7SUFDWCxDQUFDO0lBQ0QsT0FBTyxHQUFHLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLFdBQVcsRUFBRSxFQUFFLENBQUE7QUFDMUUsQ0FBQyxDQUFBO0FBRUQsTUFBTSxpQkFBaUIsR0FBRyxJQUFJLEdB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