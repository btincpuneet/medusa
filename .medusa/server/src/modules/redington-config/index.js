"use strict";
// Redington configuration bridge
//
// This module mirrors the custom Magento configuration screens found under
// B2C/app/code/Redington/**/etc/adminhtml/system.xml.
// Each setting is exposed as an environment variable so the Medusa stack can
// consume the same values without hard-coding Magento dependencies.
Object.defineProperty(exports, "__esModule", { value: true });
exports.buildRedingtonConfig = exports.redingtonConfig = void 0;
const truthyValues = new Set(["1", "true", "yes", "on"]);
const readEnv = (key) => {
    const raw = process.env[key];
    if (!raw) {
        return undefined;
    }
    const trimmed = raw.trim();
    return trimmed.length ? trimmed : undefined;
};
const readBool = (key, fallback = false) => {
    const raw = readEnv(key);
    if (!raw) {
        return fallback;
    }
    return truthyValues.has(raw.toLowerCase());
};
const readNumber = (key, fallback) => {
    const raw = readEnv(key);
    if (!raw) {
        return fallback;
    }
    const parsed = Number(raw);
    return Number.isFinite(parsed) ? parsed : fallback;
};
const readList = (key, options = {}) => {
    const raw = readEnv(key);
    if (!raw) {
        return options.fallback ?? [];
    }
    const separator = options.separator ?? /[,\n]+/;
    return raw
        .split(separator)
        .map((entry) => entry.trim())
        .filter(Boolean);
};
const buildRedingtonConfig = () => {
    return {
        product: {
            disableDefaultStock: readBool("REDINGTON_PRODUCT_DISABLE_DEFAULT_STOCK"),
            domainStockControlEnabled: readBool("REDINGTON_DOMAIN_STOCK_CONTROL_ENABLED"),
            domainAuthenticationEnabled: readBool("REDINGTON_DOMAIN_AUTH_ENABLED"),
            maxOrderDurationMonths: readNumber("REDINGTON_PRODUCT_MAX_ORDER_DURATION"),
            restrictedCategoryId: readEnv("REDINGTON_PRODUCT_CATEGORY_ROOT_ID"),
        },
        enquiries: {
            getInTouchReceiver: readEnv("REDINGTON_GET_IN_TOUCH_EMAIL"),
            outOfStock: {
                requestTemplate: readEnv("REDINGTON_STOCK_ENQUIRY_EMAIL_TEMPLATE"),
                notifyTemplate: readEnv("REDINGTON_STOCK_ENQUIRY_NOTIFY_TEMPLATE"),
                requestSubject: readEnv("REDINGTON_STOCK_ENQUIRY_EMAIL_SUBJECT"),
                notifySubject: readEnv("REDINGTON_STOCK_ENQUIRY_NOTIFY_SUBJECT"),
                senderIdentity: readEnv("REDINGTON_STOCK_ENQUIRY_EMAIL_SENDER"),
            },
        },
        payment: {
            apiUrl: readEnv("REDINGTON_PAYMENT_API_URL"),
            username: readEnv("REDINGTON_PAYMENT_USERNAME"),
            password: readEnv("REDINGTON_PAYMENT_PASSWORD"),
            availableMethods: readList("REDINGTON_AVAILABLE_PAYMENT_METHODS"),
        },
        sap: {
            domain: readEnv("REDINGTON_SAP_DOMAIN"),
            ksaCompanyCode: readEnv("REDINGTON_SAP_KSA_COMPANY_CODE"),
            notificationRecipients: readList("REDINGTON_SAP_NOTIFICATION_RECIPIENTS"),
            apiUrl: readEnv("REDINGTON_SAP_API_URL"),
            clientId: readEnv("REDINGTON_SAP_API_CLIENT_ID"),
            clientSecret: readEnv("REDINGTON_SAP_API_CLIENT_SECRET"),
            customerNumber: readEnv("REDINGTON_SAP_CUSTOMER_NUMBER"),
            invoiceApiUrl: readEnv("REDINGTON_SAP_INVOICE_API_URL"),
            invoiceClientId: readEnv("REDINGTON_SAP_INVOICE_CLIENT_ID"),
            invoiceClientSecret: readEnv("REDINGTON_SAP_INVOICE_CLIENT_SECRET"),
            invoicePdfApiUrl: readEnv("REDINGTON_SAP_INVOICE_PDF_API_URL"),
        },
        guestUsers: {
            allowedDomains: readList("REDINGTON_GUEST_ALLOWED_DOMAINS", {
                separator: /[\n,]+/,
            }),
        },
        smsOtp: {
            enabled: readBool("REDINGTON_SMS_ENABLE_OTP"),
            apiUrl: readEnv("REDINGTON_SMS_API_URL"),
            clientId: readEnv("REDINGTON_SMS_CLIENT_ID"),
            clientSecret: readEnv("REDINGTON_SMS_CLIENT_SECRET"),
            senderId: readEnv("REDINGTON_SMS_SENDER_ID"),
            application: readEnv("REDINGTON_SMS_APPLICATION"),
            otpText: readEnv("REDINGTON_SMS_OTP_TEXT"),
        },
    };
};
exports.buildRedingtonConfig = buildRedingtonConfig;
// Snapshot of the Redington configuration derived from environment variables.
// Call buildRedingtonConfig() if you need to re-evaluate during runtime.
exports.redingtonConfig = buildRedingtonConfig();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvbW9kdWxlcy9yZWRpbmd0b24tY29uZmlnL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxpQ0FBaUM7QUFDakMsRUFBRTtBQUNGLDJFQUEyRTtBQUMzRSxzREFBc0Q7QUFDdEQsNkVBQTZFO0FBQzdFLG9FQUFvRTs7O0FBSXBFLE1BQU0sWUFBWSxHQUFHLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQTtBQUV4RCxNQUFNLE9BQU8sR0FBRyxDQUFDLEdBQVcsRUFBc0IsRUFBRTtJQUNsRCxNQUFNLEdBQUcsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQzVCLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUNULE9BQU8sU0FBUyxDQUFBO0lBQ2xCLENBQUM7SUFDRCxNQUFNLE9BQU8sR0FBRyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUE7SUFDMUIsT0FBTyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQTtBQUM3QyxDQUFDLENBQUE7QUFFRCxNQUFNLFFBQVEsR0FBRyxDQUFDLEdBQVcsRUFBRSxRQUFRLEdBQUcsS0FBSyxFQUFXLEVBQUU7SUFDMUQsTUFBTSxHQUFHLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQ3hCLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUNULE9BQU8sUUFBUSxDQUFBO0lBQ2pCLENBQUM7SUFDRCxPQUFPLFlBQVksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUE7QUFDNUMsQ0FBQyxDQUFBO0FBRUQsTUFBTSxVQUFVLEdBQUcsQ0FBQyxHQUFXLEVBQUUsUUFBaUIsRUFBc0IsRUFBRTtJQUN4RSxN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